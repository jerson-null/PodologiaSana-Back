# render.yaml

services:
  # --- 1. CONFIGURACI√ìN DE LA BASE DE DATOS MYSQL (Servicio Privado) ---
  - type: pserv # Private Service (no accesible desde internet)
    name: mysql-db
    env: docker
    dockerContext: .
    # imagen oficial de MySQL
    image: mysql/mysql-server:8.0
    plan: starter # Plan b√°sico de inicio
    
    # credenciales
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        value: adminrender
      - key: MYSQL_DATABASE
        services:
          # --- 1. CONFIGURACI√ìN DE LA BASE DE DATOS MYSQL (Servicio Privado) ---
          - type: pserv # Private Service (no accesible desde internet)
            name: mysql-db
            env: docker
            # Usamos la imagen oficial de MySQL
            image:
              url: docker.io/mysql/mysql-server:8.0
            plan: starter # Plan b√°sico de inicio

            # ‚ö†Ô∏è Credenciales de la BD (C√ÅMBIALAS)
            envVars:
              - key: MYSQL_ROOT_PASSWORD
                value: TU_ROOT_PASSWORD
              - key: MYSQL_DATABASE
                value: TU_NOMBRE_BD
              - key: MYSQL_USER
                value: TU_USUARIO_BD
              - key: MYSQL_PASSWORD
                value: TU_PASSWORD_BD

            # üíæ Configuraci√≥n ESENCIAL: Disco persistente para que los datos no se pierdan
            disk:
              name: mysql-data
              mountPath: /var/lib/mysql # Directorio est√°ndar de datos de MySQL
              sizeGB: 1 # Tama√±o inicial (ajusta si necesitas m√°s)

          # --- 2. CONFIGURACI√ìN DE TU BACKEND (Servicio Web) ---
          - type: web # Web Service (accesible desde internet)
            name: podologia-backend
            env: node # Entorno Node.js
            # Enlaza a tu repositorio
            repo: https://github.com/jerson-null/PodologiaSana-Back

            # Comando para instalar dependencias y levantar el servidor
            buildCommand: npm install
            startCommand: npm start

            # üîó Variables para la conexi√≥n a MySQL (¬°Usando el nombre interno del servicio!)
            envVars:
              - key: DB_HOST
                value: mysql-db     # <-- Nombre del servicio de BD (del paso 1)
              - key: DB_PORT
                value: "3306"
              - key: DB_USER
                value: TU_USUARIO_BD
              - key: DB_PASSWORD
                value: TU_PASSWORD_BD
              - key: DB_NAME
                value: TU_NOMBRE_BD